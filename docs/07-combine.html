<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Combining</title>

<script src="site_libs/header-attrs-2.19/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>


<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R4SSP Semester 1 2023</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Modules
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Intro</li>
    <li>
      <a href="01-intro.html">Intro to R and RStudio</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Data Focus</li>
    <li>
      <a href="02-visualise.html">Part 1: Visualising</a>
    </li>
    <li>
      <a href="03-subset.html">Part 2: Subsetting</a>
    </li>
    <li>
      <a href="04-summarise.html">Part 3: Summarising</a>
    </li>
    <li>
      <a href="05-communicate.html">Part 4: Communicating</a>
    </li>
    <li>
      <a href="06-tidying.html">Part 5: Tidying</a>
    </li>
    <li>
      <a href="07-combine.html">Part 6: Combining</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Programming focus</li>
    <li>
      <a href="08-functions.html">Functions and Choices</a>
    </li>
    <li>
      <a href="09-iterate.html">Repeating Code</a>
    </li>
    <li>
      <a href="10-workflows.html">Workflows</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Extra</li>
    <li class="dropdown-header">Version control</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Zoom Notes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="zoom_notes_01_intro.html">01 - Introducing R and RStudio</a>
    </li>
    <li>
      <a href="zoom_notes_02_visualise.html">02 - Visualising data</a>
    </li>
    <li>
      <a href="zoom_notes_03_subset.html">03 - Subsetting data</a>
    </li>
    <li>
      <a href="zoom_notes_04_summarise.html">04- Summarising data</a>
    </li>
    <li>
      <a href="zoom_notes_05_communicate.html">05 - Communicating data</a>
    </li>
    <li>
      <a href="zoom_notes_06_tidying.html">06 - Tidying data</a>
    </li>
    <li>
      <a href="zoom_notes_07_combine.html">07 - Combining data</a>
    </li>
    <li>
      <a href="zoom_notes_08_functions.html">08 - Functions and Choices</a>
    </li>
    <li>
      <a href="zoom_notes_09_iterate.html">09 - Repeating Code</a>
    </li>
    <li>
      <a href="zoom_notes_10_workflows.html">10 - Workflows</a>
    </li>
  </ul>
</li>
<li>
  <a href="about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Combining</h1>
<h4 class="date">Semester 1, 2023</h4>

</div>


<blockquote>
<h4 id="associated-material">Associated Material</h4>
<p>Module: <a href="07-combine.html">Module 07 - Combining data</a></p>
<p>Readings</p>
<ul>
<li><a href="https://r4ds.had.co.nz/relational-data.html">R for Data
Science Chapter 13</a></li>
</ul>
</blockquote>
<div id="combining-data" class="section level2">
<h2>Combining Data</h2>
<p>So far, each data set we have worked with has been contained in a
single monolithic data file with all variables as columns and all
observations as rows. In a real reserach situation, this will not always
be the case. Complex data sets are often deployed as multiple related
files. Each file represents a single, well-defined data entity, and the
relationships between entities are part of the data provided. In order
to answer our research questions, we need to be able to combine these
different files in various, sometimes complex ways.</p>
</div>
<div id="describing-the-data-universe" class="section level2">
<h2>Describing the Data Universe</h2>
<p>The complex systems we study generally consist of many different
<strong>entities</strong> (“things”, like participants, test results,
experimental conditions, species, researchers, equipment, lakes, etc.).
Each entity has important <strong>properties</strong> (e.g. subject ID,
reaction time, equipment type, etc.). There are complex
<strong>relationships</strong> between entities (e.g. a particular
participant was given a specific experimental treatment, a particular
animal species was seen in a specific lake). Together, these constitute
our <strong>data universe</strong>.</p>
<p>To answer our research questions, we need to be able to represent the
data universe in an organised way. The challenges this imposes can be
seen even in comparatively simple contexts.</p>
<p>For example, assume you are involved with the local softball
competitions. There are multiple leagues, each league has multiple
teams, each team has a coach and many players. Your job might be to
maintain contact information so that people can be informed when there
are changes to the game schedule.</p>
<p>As an experienced computer user, you can decide to put all this
informtion into some nice spreadsheets. For example, you might have a
spreadsheet like this for one team:</p>
<div class="figure" style="text-align: center">
<img src="images/07-sports_league_01.PNG" alt="The Gnomes" width="100%" />
<p class="caption">
The Gnomes
</p>
</div>
<p>You would have a comparable spreadsheet for each team in each
league.</p>
<p>If your data only need to be available to people, this system would
probably be adequate, if a little cumbersome. However, if you wanted to
load your data into a computer for processing, this file format will not
work. Recall that R needs a rectangle of data with column headers across
the top and one row for each data point. You couldn’t even import your
data using this “human-friendly” spreadsheet.</p>
<p>To provide the same information in a format that a computer can
understand, you must do the following:</p>
<ol style="list-style-type: decimal">
<li>Identify the cohesive entities in your data</li>
<li>Identify the properties for each entity</li>
<li>Make a separate file for each entity</li>
<li>Make the relationships between entities explicit in their data (see
examples below).</li>
</ol>
<p>In our Sports League example, we see that we have two clear entities
– Teams and Players. A Team has four properties: the name, the league,
the coach, and the coach’s phone number. A Player has four properties:
their team, their name, their phone number, and the position they play.
In our current format, Teams and Players are all mixed into the same
file. For the computer, we need to separate them. Making each property a
column, and each instance a row, we can reformat our data into two
separate files, like this:</p>
<div class="figure" style="text-align: center">
<img src="images/07-sports_league_02.PNG" alt="Sports League for Computers" width="100%" />
<p class="caption">
Sports League for Computers
</p>
</div>
<p>Note that these files are in exactly the rectangular “rows are
instances; columns are variables” format that R requires. You can easily
read them into R and start processing them. For example, if there are
800 players in the Players spreadsheet, how would you determine the
number of players assigned to each position, across the entire
league?</p>
<p>Assuming you have used <code>read.csv</code> to import the Players
spreadsheet into a dataframe <code>players_df</code>, you could say:
<code>players_df %&gt;% group_by(PlayerPosition) %&gt;% count()</code>.</p>
<p>By making two separate spreadsheets, you have separated the
information about players from the information about teams. It is
essential that, when your data are reorganised in this way, no
information has been lost. That is <em>can you answer the same questions
with this arrangement as you could with the original one?</em></p>
<p>For example, with the first human-friendly version, it is easy to
answer <em>“Who is Fred’s coach?”</em>, because Fred and his coach are
in the same spreadsheet. But how do you do it with the computer-friendly
organisation where Fred’s data and his Team’s data are in different
files?</p>
<p>As a person you would say “Fred’s team is The Gnomes (from sheet 2)
and Bob is the coach of The Gnomes (from sheet 1) therefore Bob is the
coach of Fred.” To do it in R (as you would if you needed to perform
this operation for 800 players) you would select the TeamName value for
Fred in the Players file, then filter for that value in the Teams file
and select the Coach column. After you learn how to write loops, you
could loop through all the players and do this computation, accruing the
results into a vector. Then you could add that vector as a new column
somewhere to match up player and coach. However, R provides much more
succinct ways to perform this operation.</p>
<p>This is fortunate, because real research data sets are often deployed
in many more than just the two files we needed in our toy Sports League
example. Large, complex data sets are typically not managed with
spreadsheets at all, they are managed as <strong>databases</strong>.
While this term is used quite broadly in casual discussion, it
technically refers specifically to <strong>Relational Database
Management Systems</strong>, special applications that are optimised for
searching, deleting, filtering, and generally managing huge amounts of
data.</p>
<p>In an RDBMS each <strong>entity</strong> has its own
<strong>table</strong> and the tools have EXTREMELY strict rules about
the contents and structure of their entities. The data universe is
broken down into atomic pieces of data and recombined through the rules
of a mathematical framework called the Relational Algebra. It is a
beautiful thing, but you end up with a lot of tables.</p>
<p>The figure below is an <strong>Entity Relationship Diagram</strong>.
It shows the structure of the database for a <em>relatively simple</em>
database system that keeps track of Food Diaries – where people record
what they eat for nutritional analysis.</p>
<div class="figure" style="text-align: center">
<img src="images/07-ERD.png" alt="Example ERD" width="100%" />
<p class="caption">
Example ERD
</p>
</div>
<p>When real data are exported to you for processing, therefore, you can
end up with a lot of separate files. Using R, you have to be able to
recombine data as needed to answer your specific research questions.</p>
</div>
<div id="simple-combining-binds" class="section level2">
<h2>Simple Combining (Binds)</h2>
<p>Before we look at the sometimes complex issues around combining
tables representing different entities, we will quickly cover two
simpler combining situations that occur when you have, essentially, a
single table that has been broken into multiple input files.</p>
<p>Our data for today come from the <strong>Geckos and Gumboots</strong>
project. Geckos and Gumboots is a multi-year, multi-disciplinary
reconstruction of wild New Zealand Gecko habitat on the Otago Peninsula
(South Island, New Zealand). A large area of land on the peninsula has
been planted with native gecko habitat species, divided into replicate
quadrats and, at intervals, data are collected about plant growth, and
invertebrate, predator, and gecko population abundance. Undergraduate
students participate in data collection and analysis to gain experience
with ecology fieldwork.</p>
<div id="combining-rows" class="section level3">
<h3>Combining Rows</h3>
<p>Assume the field ecologists have sent you some predator observation
data for analysis. They have sent you three separate csv files, one for
each of three data collection days.</p>
<div class="figure" style="text-align: center">
<img src="images/07-rbind.PNG" alt="Combining Rows" width="100%" />
<p class="caption">
Combining Rows
</p>
</div>
<p>All three files have exactly the same format – four variable columns
and one row for each recorded predator observation. This is a nice way
to get data – everything is already rectangular, and they have all the
same columns in the same order. You simply need to gather them all up
into a single dataframe – in R this is straightforward. Use function
<code>rbind</code>, passing in all the data frames to be concatenated,
separated by commas.</p>
<pre class="r"><code>pred_01_df &lt;- read.csv(&quot;data/predator_observations_2022_04_30.csv&quot;)
pred_02_df &lt;- read.csv(&quot;data/predator_observations_2023_04_22.csv&quot;)
pred_03_df &lt;- read.csv(&quot;data/predator_observations_2023_04_23.csv&quot;)

pred_all_df &lt;- rbind(pred_01_df, pred_02_df, pred_03_df)
pred_all_df[50:60,]
#&gt;    ObservationDate ReplicateSite  PredatorType CardType
#&gt; 50      30/04/2022            R4 none detected     Chew
#&gt; 51      30/04/2022            R5 none detected     Chew
#&gt; 52      30/04/2022            R6      Hedgehog   Tunnel
#&gt; 53      30/04/2022            R6         Mouse   Tunnel
#&gt; 54      30/04/2022            R6 none detected     Chew
#&gt; 55      22/04/2023            R1         Mouse     Chew
#&gt; 56      22/04/2023            R1         Mouse   Tunnel
#&gt; 57      22/04/2023            R3         Mouse     Chew
#&gt; 58      22/04/2023            R3         Mouse   Tunnel
#&gt; 59      22/04/2023            R3           Rat     Chew
#&gt; 60      22/04/2023            R6         Mouse     Chew</code></pre>
<p>Note that if the arguments to rbind don’t all have exactly the same
columns, the function will, quite sensibly, throw an error:</p>
<pre class="r"><code># For purposes of illustrion, we drop the 4th column from pred_01_df
pred_01_df &lt;- pred_01_df[ , -4]

# The rbind command now fails
pred_all_df &lt;- rbind(pred_01_df, pred_02_df, pred_03_df)
#&gt; Error in rbind(deparse.level, ...): numbers of columns of arguments do not match</code></pre>
</div>
<div id="combining-columns" class="section level3">
<h3>Combining Columns</h3>
<p>Less commonly, you might have multiple data sets with the same rows
(obervations), but different columns (dependent and independent
variables). In this case, use function <code>cbind</code> – the syntax
is the same as for <code>rbind</code>.</p>
<p>In practice, this situation actually occurs very rarely. This is
fortunate, because column binding is extremely risky. Column binding
relies entirely upon the rows in the separate data frames being
identical and in the same order; the function itself performs no checks
on this constraint.</p>
<p>Because of the danger of mixing up data from different observations,
I only use cbind when I am generating columns dynamically (in code) and
wish to build a data frame from them.</p>
</div>
</div>
<div id="relational-combining-joins" class="section level2">
<h2>Relational Combining (Joins)</h2>
<p>Recall our Sports League data:</p>
<div class="figure" style="text-align: center">
<img src="images/07-sports_league_02.PNG" alt="Sports League for Computers" width="100%" />
<p class="caption">
Sports League for Computers
</p>
</div>
<p>Our “research question” was how to find the name of Bob’s coach. More
generally, assume we want to know the coaches of all the players. When
working with data frames, this means we want to add columns to the
Player’s table that contain the associated coach information for each
row.</p>
<p>We noted that the Team table and the Player table have a common
column – TeamName – and that we could match players and coaches by
looking for matching values of TeamName. This is a requirement for
relational combining – two tables must share a common column (or
columns) that can be used to match observations betwen the tables. These
common columns are called <strong>keys</strong>.</p>
<p>In formal databases, there are lots of rules about keys, particularly
around <strong>uniqueness</strong>. Note how confusing it would be if
there were <em>two</em> rows in the Teams data frame with teamname
<em>The Gnomes</em> – which of the two coaches would you want to match
with Fred? <a href="#fn1" class="footnote-ref"
id="fnref1"><sup>1</sup></a> For today we will assume that these
requirements are met – for further details, see the R for Data Science
chapter.</p>
</div>
<div id="join" class="section level2">
<h2>Join</h2>
<p>In database terminology, the process of matching up records from
multiple tables is called a <strong>join</strong>. R (more specifically
tidyverse) uses this terminology as well. Solving problems like finding
the coach for each player involves joining two or more data frames on
one or more common columns.</p>
<p>To slightly complicate things, R does not provide a function called
“join”. It provide <em>six different functions</em> which perform
slightly different types of join operation. The function names are
derived from the formal database terminology. Fortunately, in the vast
majority of cases we encounter, you only need one of the join family –
<code>left_join</code>. We will cover <code>left_join</code> here; see
the additional readings for discussions of the less common forms.</p>
<p>The function <code>left_join</code> takes as arguments the two tables
(data frames) you wish to join. The name <code>left_join</code> helps
you to remember how to order your arguments – put the <strong>base
table</strong> on the left (i.e. as the first argument). The
<strong>base table</strong> is the one you wish to add columns to.</p>
<p>Recall that we wanted to know each player’s coach. We therefore want
to add a CoachName column to the Players data frame. Thus Players is the
<strong>base table</strong>. We pass it first into function ‘left_join’,
along with the name of the <strong>key</strong> column.</p>
<pre class="r"><code># We need the tidyverse to be able to join
library(tidyverse)

# Assume we have imported out sports league data using read.csv
head(teams_df)
#&gt;        TeamName          League   Coach   CoachPhone
#&gt; 1    The Gnomes        Over 50s     Bob     474-5555
#&gt; 2      The Orcs Women&#39;s Premier  Ngaire 021 333-4567
#&gt; 3 The Arachnids       Under 15s Dorothy 022 987-6543
head(players_df)
#&gt;   PlayerName      TeamName PlayerPosition  PlayerPhone
#&gt; 1       Fred    The Gnomes     First Base 021 111 2222
#&gt; 2      Sally    The Gnomes        Pitcher 021 222 3333
#&gt; 3      Ethel    The Gnomes     Left Field 021 111 4444
#&gt; 4       Lucy The Arachnids        Catcher     474-1234

# Perform the join
extended_players_df &lt;- left_join(players_df, teams_df, by = &quot;TeamName&quot;)

# The new data frame
extended_players_df
#&gt;   PlayerName      TeamName PlayerPosition  PlayerPhone    League   Coach
#&gt; 1       Fred    The Gnomes     First Base 021 111 2222  Over 50s     Bob
#&gt; 2      Sally    The Gnomes        Pitcher 021 222 3333  Over 50s     Bob
#&gt; 3      Ethel    The Gnomes     Left Field 021 111 4444  Over 50s     Bob
#&gt; 4       Lucy The Arachnids        Catcher     474-1234 Under 15s Dorothy
#&gt;     CoachPhone
#&gt; 1     474-5555
#&gt; 2     474-5555
#&gt; 3     474-5555
#&gt; 4 022 987-6543</code></pre>
<p>The new dataframe has all the columns in Players, in the original
order. It also has all the columns in Teams, in the original order. For
<em>each row of Players</em> (the base table; the one on the left), the
values of the Teams columns are taken from the row in Teams that has the
same value in column TeamName (the key).</p>
<div id="exercise" class="section level3">
<h3>Exercise</h3>
<p>What output do you expect if you reverse the order of
<code>players_df</code> and <code>teams_df</code> in the call to
<code>left_join</code>, above? Try to think through this exercise before
testing the code. Hint: When you reach the point where you say “but that
doesn’t make sense!”, recognise that the computer will be in the same
situation.</p>
</div>
</div>
<div id="practice-joining" class="section level2">
<h2>Practice Joining</h2>
<p>The Geckos and Gumboots project provides information about the plants
observed growing in each quadrat (resource file
<em>plant_observations.csv</em>). In a separate file, they provide
additional information about plant species (resource file
<em>plant_species.csv</em>). This mirrors the structure of the database,
where these entities are stored separately to allow efficient data
operations and complete representation of the data universe (e.g. to
allow information to be stored for plant species that have not yet been
observed, but which are expected to be in the future).</p>
<div class="figure" style="text-align: center">
<img src="images/07-plant_data_input_files.PNG" alt="Plant Observation and Species Data Input Files" width="100%" />
<p class="caption">
Plant Observation and Species Data Input Files
</p>
</div>
<p><strong>Your job</strong>: Produce a new data frame that adds family
and common names for each plant observation.</p>
<pre class="r"><code># Load the input data frames
plant_obs_df &lt;- read.csv(&quot;data/plant_observations.csv&quot;)
plant_species_df &lt;- read.csv(&quot;data/plant_species.csv&quot;)

# Perform the join
extended_plant_obs_df &lt;- left_join(plant_obs_df, plant_species_df, 
                                   join_by(PlantSpecies))

# Display a section of the result
extended_plant_obs_df[55:65,]
#&gt;    ObservationDate ReplicateSite           PlantSpecies Height Circumference
#&gt; 55      22/04/2023            R1      Jacobaea vulgaris     80         18.85
#&gt; 56      22/04/2023            R4   Coprosma crassifolia     60         25.00
#&gt; 57      22/04/2023            R4      Podocarpus laetus     70         25.00
#&gt; 58      22/04/2023            R4     Coprosma propinqua     42         25.00
#&gt; 59      22/04/2023            R5   Coprosma crassifolia     32         54.00
#&gt; 60      22/04/2023            R2         Ulex europaeus     41         13.00
#&gt; 61      22/04/2023            R2         Ulex europaeus     49         12.00
#&gt; 62      22/04/2023            L2 Tetragonia implexicoma     19        540.00
#&gt; 63      22/04/2023            L2        Myoporum laetum     26         40.00
#&gt; 64      22/04/2023            L2        Isolepis cernua     35         25.00
#&gt; 65      22/04/2023            L2        Isolepis cernua     15         52.00
#&gt;     PlantFamilyNAme    PlantCommonName
#&gt; 55       Asteraceae            Ragwort
#&gt; 56        Rubiaceae                   
#&gt; 57    Podocarpaceae Thin-barked t?tara
#&gt; 58        Rubiaceae                   
#&gt; 59        Rubiaceae                   
#&gt; 60         Fabaceae              Gorse
#&gt; 61         Fabaceae              Gorse
#&gt; 62        Aizoaceae         NZ spinach
#&gt; 63 Scrophulariaceae     Mousehole tree
#&gt; 64       Cyperaceae   Slender clubrush
#&gt; 65       Cyperaceae   Slender clubrush</code></pre>
</div>
<div id="a-complete-research-question" class="section level2">
<h2>A Complete Research Question</h2>
<p>Package <code>nycflights13</code> contains several data frames which
hold historical data about airplane flights in and out of the several
airports in New York city. There is one table for each important entity.
Each table contains entity properties, and relation information.</p>
<ul>
<li>airports: Airport FAA code, name, latitude, longitude, time zone,
etc. for each airport</li>
<li>planes: Tail number, year of manufacture, and technical
specification for each plane</li>
<li>airlines: FAA code and company name for each airline</li>
<li>flights: Date, departure and arrival times, plane information,
distance, airline code, etc. for each flight</li>
</ul>
<p><strong>Your job</strong>: Determine which airline flew the total
greatest distance using single engine planes.</p>
<p><strong>Hint</strong>: Do not start typing code yet.</p>
<p>With any but the simplest problems, you should always make a plan
<em>before</em> you start coding. Remember that computers need to have
<strong>every single step</strong> laid out for them, and in ways they
understand. It is often difficult to work out exactly what those steps
should be.</p>
<p>Our intial plan might be:</p>
<ol style="list-style-type: decimal">
<li>Find all the flights made by single engine planes</li>
<li>Add the distances up for each airline</li>
<li>See which is the largest.</li>
</ol>
<p>But this plan is not sufficiently detailed for the computer. How, for
example, will you tell the computer to determine which flights were made
by single engine planes? The <code>planes</code> data frame contains the
number of engines for each plane, but the <code>flights</code> data
frame does not – it contains only the flight number (column
<code>flightnum</code>). Fortunately, <code>planes</code> also contains
<code>flightnum</code> so we can use that column as a key to join the
two tables.</p>
<p>Our computer-friendly plan:</p>
<ol style="list-style-type: decimal">
<li>Join <code>flights</code> and <code>planes</code> with flights as
the base and <code>tailnum</code> as the key to add the plane
information for each flight.</li>
<li>From the resulting extended flights data, select those with only one
engine (i.e. field engines == 1)</li>
<li>The flights table contains column <code>carrier</code> to identify
the airline. Use group_by and summarise to compute the total
<code>distance</code> grouped by <code>carrier</code>.</li>
<li>Pick the largest</li>
</ol>
<p>Now you are ready to write your code:</p>
<pre class="r"><code>
library(nycflights13)

# 1. Join `flights` and `planes` with flights as the base and `tailnum` as the key to add the plane information for each flight.

flights_planes &lt;- left_join(flights, planes, by = &quot;tailnum&quot;)

# 2. From the resulting extended flights data, select those with only one engine (i.e. field engines == 1)

single_engine_flights &lt;- flights_planes %&gt;% filter(engines == 1)

# 3. The flights table contains column `carrier` to identify the aireline. Using group_by and summarise compute the total `distance` grouped by `carrier`.

carrier_distance &lt;- single_engine_flights %&gt;% group_by(carrier) %&gt;% summarise(TotalDistance = sum(distance))

# 4. Pick the largest

# Sort descending
carrier_distance &lt;- carrier_distance %&gt;% arrange(desc(TotalDistance))

# Display
carrier_distance
#&gt; # A tibble: 4 × 2
#&gt;   carrier TotalDistance
#&gt;   &lt;chr&gt;           &lt;dbl&gt;
#&gt; 1 B6            1077735
#&gt; 2 AA             882584
#&gt; 3 MQ             244203
#&gt; 4 FL               2286</code></pre>
<p>This is close, but what if you don’t know what B6 stands for?. Recall
that data frame <code>airlines</code> contains carrier code and full
name. To improve your analysis clarity, extend your
<code>carrier_distance</code> table to include the full airline name.
What operation will you perform? What arguments will you provide?</p>
<pre class="r"><code>left_join(carrier_distance, airlines, by = &quot;carrier&quot;)
#&gt; # A tibble: 4 × 3
#&gt;   carrier TotalDistance name                       
#&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;                      
#&gt; 1 B6            1077735 JetBlue Airways            
#&gt; 2 AA             882584 American Airlines Inc.     
#&gt; 3 MQ             244203 Envoy Air                  
#&gt; 4 FL               2286 AirTran Airways Corporation</code></pre>
<p>You have now established that JetBlue Airways flew the greatest total
distance using single engine planes.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>NB: There is a method for dealing with the “multiple
coaches” problem, but it is out of scope for today’s module. Ask me for
more detail if you’re interested.<a href="#fnref1"
class="footnote-back">↩︎</a></p></li>
</ol>
</div>

<div id="rmd-source-code">LS0tDQp0aXRsZTogIkNvbWJpbmluZyINCmRhdGU6ICJTZW1lc3RlciAxLCAyMDIzIg0Kb3V0cHV0Og0KICBodG1sX2RvY3VtZW50Og0KICAgIHRvYzogdHJ1ZQ0KICAgIHRvY19mbG9hdDogdHJ1ZQ0KICAgIHRvY19kZXB0aDogMw0KICAgIGNvZGVfZG93bmxvYWQ6IHRydWUNCiAgICBjb2RlX2ZvbGRpbmc6IHNob3cNCi0tLQ0KDQpgYGB7ciBzZXR1cCwgaW5jbHVkZT1GQUxTRX0NCmxpYnJhcnkoa25pdHIpDQpsaWJyYXJ5KHRpZHl2ZXJzZSkNCmtuaXRyOjpvcHRzX2NodW5rJHNldCgNCiAgY29tbWVudCA9ICIjPiIsDQogIGZpZy5wYXRoID0gImZpZ3VyZXMvMDcvIiwgIyB1c2Ugb25seSBmb3Igc2luZ2xlIFJtZCBmaWxlcw0KICBjb2xsYXBzZSA9IFRSVUUsDQogIGVjaG8gPSBUUlVFDQopDQpgYGANCg0KPiAjIyMjIEFzc29jaWF0ZWQgTWF0ZXJpYWwNCj4NCj4gTW9kdWxlOiBbTW9kdWxlIDA3IC0gQ29tYmluaW5nIGRhdGFdKDA3LWNvbWJpbmUuaHRtbCkNCj4NCj4gUmVhZGluZ3MNCj4NCj4gLSBbUiBmb3IgRGF0YSBTY2llbmNlIENoYXB0ZXIgMTNdKGh0dHBzOi8vcjRkcy5oYWQuY28ubnovcmVsYXRpb25hbC1kYXRhLmh0bWwpDQoNCg0KIyMgQ29tYmluaW5nIERhdGENClNvIGZhciwgZWFjaCBkYXRhIHNldCB3ZSBoYXZlIHdvcmtlZCB3aXRoIGhhcyBiZWVuIGNvbnRhaW5lZCBpbiBhIHNpbmdsZSBtb25vbGl0aGljIGRhdGEgZmlsZSB3aXRoIGFsbCB2YXJpYWJsZXMgYXMgY29sdW1ucyBhbmQgYWxsIG9ic2VydmF0aW9ucyBhcyByb3dzLiBJbiBhIHJlYWwgcmVzZXJhY2ggc2l0dWF0aW9uLCB0aGlzIHdpbGwgbm90IGFsd2F5cyBiZSB0aGUgY2FzZS4gQ29tcGxleCBkYXRhIHNldHMgYXJlIG9mdGVuIGRlcGxveWVkIGFzIG11bHRpcGxlIHJlbGF0ZWQgZmlsZXMuIEVhY2ggZmlsZSByZXByZXNlbnRzIGEgc2luZ2xlLCB3ZWxsLWRlZmluZWQgZGF0YSBlbnRpdHksIGFuZCB0aGUgcmVsYXRpb25zaGlwcyBiZXR3ZWVuIGVudGl0aWVzIGFyZSBwYXJ0IG9mIHRoZSBkYXRhIHByb3ZpZGVkLiBJbiBvcmRlciB0byBhbnN3ZXIgb3VyIHJlc2VhcmNoIHF1ZXN0aW9ucywgd2UgbmVlZCB0byBiZSBhYmxlIHRvIGNvbWJpbmUgdGhlc2UgZGlmZmVyZW50IGZpbGVzIGluIHZhcmlvdXMsIHNvbWV0aW1lcyBjb21wbGV4IHdheXMuDQoNCg0KIyMgRGVzY3JpYmluZyB0aGUgRGF0YSBVbml2ZXJzZQ0KVGhlIGNvbXBsZXggc3lzdGVtcyB3ZSBzdHVkeSBnZW5lcmFsbHkgY29uc2lzdCBvZiBtYW55IGRpZmZlcmVudCAqKmVudGl0aWVzKiogKCJ0aGluZ3MiLCBsaWtlIHBhcnRpY2lwYW50cywgdGVzdCByZXN1bHRzLCBleHBlcmltZW50YWwgY29uZGl0aW9ucywgc3BlY2llcywgcmVzZWFyY2hlcnMsIGVxdWlwbWVudCwgbGFrZXMsIGV0Yy4pLiBFYWNoIGVudGl0eSBoYXMgaW1wb3J0YW50ICoqcHJvcGVydGllcyoqIChlLmcuIHN1YmplY3QgSUQsIHJlYWN0aW9uIHRpbWUsIGVxdWlwbWVudCB0eXBlLCBldGMuKS4gVGhlcmUgYXJlIGNvbXBsZXggKipyZWxhdGlvbnNoaXBzKiogYmV0d2VlbiBlbnRpdGllcyAoZS5nLiBhIHBhcnRpY3VsYXIgcGFydGljaXBhbnQgd2FzIGdpdmVuIGEgc3BlY2lmaWMgZXhwZXJpbWVudGFsIHRyZWF0bWVudCwgYSBwYXJ0aWN1bGFyIGFuaW1hbCBzcGVjaWVzIHdhcyBzZWVuIGluIGEgc3BlY2lmaWMgbGFrZSkuIFRvZ2V0aGVyLCB0aGVzZSBjb25zdGl0dXRlIG91ciAqKmRhdGEgdW5pdmVyc2UqKi4NCg0KVG8gYW5zd2VyIG91ciByZXNlYXJjaCBxdWVzdGlvbnMsIHdlIG5lZWQgdG8gYmUgYWJsZSB0byByZXByZXNlbnQgdGhlIGRhdGEgdW5pdmVyc2UgaW4gYW4gb3JnYW5pc2VkIHdheS4gVGhlIGNoYWxsZW5nZXMgdGhpcyBpbXBvc2VzIGNhbiBiZSBzZWVuIGV2ZW4gaW4gY29tcGFyYXRpdmVseSBzaW1wbGUgY29udGV4dHMuIA0KDQpGb3IgZXhhbXBsZSwgYXNzdW1lIHlvdSBhcmUgaW52b2x2ZWQgd2l0aCB0aGUgbG9jYWwgc29mdGJhbGwgY29tcGV0aXRpb25zLiBUaGVyZSBhcmUgbXVsdGlwbGUgbGVhZ3VlcywgZWFjaCBsZWFndWUgaGFzIG11bHRpcGxlIHRlYW1zLCBlYWNoIHRlYW0gaGFzIGEgY29hY2ggYW5kIG1hbnkgcGxheWVycy4gWW91ciBqb2IgbWlnaHQgYmUgdG8gbWFpbnRhaW4gY29udGFjdCBpbmZvcm1hdGlvbiBzbyB0aGF0IHBlb3BsZSBjYW4gYmUgaW5mb3JtZWQgd2hlbiB0aGVyZSBhcmUgY2hhbmdlcyB0byB0aGUgZ2FtZSBzY2hlZHVsZS4NCg0KQXMgYW4gZXhwZXJpZW5jZWQgY29tcHV0ZXIgdXNlciwgeW91IGNhbiBkZWNpZGUgdG8gcHV0IGFsbCB0aGlzIGluZm9ybXRpb24gaW50byBzb21lIG5pY2Ugc3ByZWFkc2hlZXRzLiBGb3IgZXhhbXBsZSwgeW91IG1pZ2h0IGhhdmUgYSBzcHJlYWRzaGVldCBsaWtlIHRoaXMgZm9yIG9uZSB0ZWFtOg0KDQpgYGB7ciwgZmlnLmNhcCA9ICJUaGUgR25vbWVzIiwgZWNobz1GQUxTRSwgZmlnLmFsaWduPSdjZW50ZXInLCBvdXQud2lkdGg9IjEwMCUifQ0KaW5jbHVkZV9ncmFwaGljcygiaW1hZ2VzLzA3LXNwb3J0c19sZWFndWVfMDEucG5nIikNCmBgYA0KDQpZb3Ugd291bGQgaGF2ZSBhIGNvbXBhcmFibGUgc3ByZWFkc2hlZXQgZm9yIGVhY2ggdGVhbSBpbiBlYWNoIGxlYWd1ZS4gDQoNCklmIHlvdXIgZGF0YSBvbmx5IG5lZWQgdG8gYmUgYXZhaWxhYmxlIHRvIHBlb3BsZSwgdGhpcyBzeXN0ZW0gd291bGQgcHJvYmFibHkgYmUgYWRlcXVhdGUsIGlmIGEgbGl0dGxlIGN1bWJlcnNvbWUuIEhvd2V2ZXIsIGlmIHlvdSB3YW50ZWQgdG8gbG9hZCB5b3VyIGRhdGEgaW50byBhIGNvbXB1dGVyIGZvciBwcm9jZXNzaW5nLCB0aGlzIGZpbGUgZm9ybWF0IHdpbGwgbm90IHdvcmsuIFJlY2FsbCB0aGF0IFIgbmVlZHMgYSByZWN0YW5nbGUgb2YgZGF0YSB3aXRoIGNvbHVtbiBoZWFkZXJzIGFjcm9zcyB0aGUgdG9wIGFuZCBvbmUgcm93IGZvciBlYWNoIGRhdGEgcG9pbnQuIFlvdSBjb3VsZG7igJl0IGV2ZW4gaW1wb3J0IHlvdXIgZGF0YSB1c2luZyB0aGlzICJodW1hbi1mcmllbmRseSIgc3ByZWFkc2hlZXQuDQoNClRvIHByb3ZpZGUgdGhlIHNhbWUgaW5mb3JtYXRpb24gaW4gYSBmb3JtYXQgdGhhdCBhIGNvbXB1dGVyIGNhbiB1bmRlcnN0YW5kLCB5b3UgbXVzdCBkbyB0aGUgZm9sbG93aW5nOg0KDQoxLiBJZGVudGlmeSB0aGUgY29oZXNpdmUgZW50aXRpZXMgaW4geW91ciBkYXRhDQoyLiBJZGVudGlmeSB0aGUgcHJvcGVydGllcyBmb3IgZWFjaCBlbnRpdHkNCjMuIE1ha2UgYSBzZXBhcmF0ZSBmaWxlIGZvciBlYWNoIGVudGl0eQ0KNC4gTWFrZSB0aGUgcmVsYXRpb25zaGlwcyBiZXR3ZWVuIGVudGl0aWVzIGV4cGxpY2l0IGluIHRoZWlyIGRhdGEgKHNlZSBleGFtcGxlcyBiZWxvdykuDQoNCkluIG91ciBTcG9ydHMgTGVhZ3VlIGV4YW1wbGUsIHdlIHNlZSB0aGF0IHdlIGhhdmUgdHdvIGNsZWFyIGVudGl0aWVzIC0tIFRlYW1zIGFuZCBQbGF5ZXJzLiBBIFRlYW0gaGFzIGZvdXIgcHJvcGVydGllczogdGhlIG5hbWUsIHRoZSBsZWFndWUsIHRoZSBjb2FjaCwgYW5kIHRoZSBjb2FjaCdzIHBob25lIG51bWJlci4gQSBQbGF5ZXIgaGFzIGZvdXIgcHJvcGVydGllczogdGhlaXIgdGVhbSwgdGhlaXIgbmFtZSwgdGhlaXIgcGhvbmUgbnVtYmVyLCBhbmQgdGhlIHBvc2l0aW9uIHRoZXkgcGxheS4gSW4gb3VyIGN1cnJlbnQgZm9ybWF0LCBUZWFtcyBhbmQgUGxheWVycyBhcmUgYWxsIG1peGVkIGludG8gdGhlIHNhbWUgZmlsZS4gRm9yIHRoZSBjb21wdXRlciwgd2UgbmVlZCB0byBzZXBhcmF0ZSB0aGVtLiBNYWtpbmcgZWFjaCBwcm9wZXJ0eSBhIGNvbHVtbiwgYW5kIGVhY2ggaW5zdGFuY2UgYSByb3csIHdlIGNhbiByZWZvcm1hdCBvdXIgZGF0YSBpbnRvIHR3byBzZXBhcmF0ZSBmaWxlcywgbGlrZSB0aGlzOg0KDQoNCmBgYHtyLCBmaWcuY2FwID0gIlNwb3J0cyBMZWFndWUgZm9yIENvbXB1dGVycyIsIGVjaG89RkFMU0UsIGZpZy5hbGlnbj0nY2VudGVyJywgb3V0LndpZHRoPSIxMDAlIn0NCmluY2x1ZGVfZ3JhcGhpY3MoImltYWdlcy8wNy1zcG9ydHNfbGVhZ3VlXzAyLnBuZyIpDQpgYGANCg0KTm90ZSB0aGF0IHRoZXNlIGZpbGVzIGFyZSBpbiBleGFjdGx5IHRoZSByZWN0YW5ndWxhciAicm93cyBhcmUgaW5zdGFuY2VzOyBjb2x1bW5zIGFyZSB2YXJpYWJsZXMiIGZvcm1hdCB0aGF0IFIgcmVxdWlyZXMuIFlvdSBjYW4gZWFzaWx5IHJlYWQgdGhlbSBpbnRvIFIgYW5kIHN0YXJ0IHByb2Nlc3NpbmcgdGhlbS4gRm9yIGV4YW1wbGUsIGlmIHRoZXJlIGFyZSA4MDAgcGxheWVycyBpbiB0aGUgUGxheWVycyBzcHJlYWRzaGVldCwgaG93IHdvdWxkIHlvdSBkZXRlcm1pbmUgdGhlIG51bWJlciBvZiBwbGF5ZXJzIGFzc2lnbmVkIHRvIGVhY2ggcG9zaXRpb24sIGFjcm9zcyB0aGUgZW50aXJlIGxlYWd1ZT8NCg0KQXNzdW1pbmcgeW91IGhhdmUgdXNlZCBgcmVhZC5jc3ZgIHRvIGltcG9ydCB0aGUgUGxheWVycyBzcHJlYWRzaGVldCBpbnRvIGEgZGF0YWZyYW1lIGBwbGF5ZXJzX2RmYCwgeW91IGNvdWxkIHNheToNCmBwbGF5ZXJzX2RmICU+JSBncm91cF9ieShQbGF5ZXJQb3NpdGlvbikgJT4lIGNvdW50KClgLg0KDQpCeSBtYWtpbmcgdHdvIHNlcGFyYXRlIHNwcmVhZHNoZWV0cywgeW91IGhhdmUgc2VwYXJhdGVkIHRoZSBpbmZvcm1hdGlvbiBhYm91dCBwbGF5ZXJzIGZyb20gdGhlIGluZm9ybWF0aW9uIGFib3V0IHRlYW1zLiBJdCBpcyBlc3NlbnRpYWwgdGhhdCwgd2hlbiB5b3VyIGRhdGEgYXJlIHJlb3JnYW5pc2VkIGluIHRoaXMgd2F5LCBubyBpbmZvcm1hdGlvbiBoYXMgYmVlbiBsb3N0LiBUaGF0IGlzICpjYW4geW91IGFuc3dlciB0aGUgc2FtZSBxdWVzdGlvbnMgd2l0aCB0aGlzIGFycmFuZ2VtZW50IGFzIHlvdSBjb3VsZCB3aXRoIHRoZSBvcmlnaW5hbCBvbmU/Kg0KDQpGb3IgZXhhbXBsZSwgd2l0aCB0aGUgZmlyc3QgaHVtYW4tZnJpZW5kbHkgdmVyc2lvbiwgaXQgaXMgZWFzeSB0byBhbnN3ZXIgKuKAnFdobyBpcyBGcmVk4oCZcyBjb2FjaD/igJ0qLCBiZWNhdXNlIEZyZWQgYW5kIGhpcyBjb2FjaCBhcmUgaW4gdGhlIHNhbWUgc3ByZWFkc2hlZXQuIEJ1dCBob3cgZG8geW91IGRvIGl0IHdpdGggdGhlIGNvbXB1dGVyLWZyaWVuZGx5IG9yZ2FuaXNhdGlvbiB3aGVyZSBGcmVkJ3MgZGF0YSBhbmQgaGlzIFRlYW0ncyBkYXRhIGFyZSBpbiBkaWZmZXJlbnQgZmlsZXM/DQoNCkFzIGEgcGVyc29uIHlvdSB3b3VsZCBzYXkg4oCcRnJlZOKAmXMgdGVhbSBpcyBUaGUgR25vbWVzIChmcm9tIHNoZWV0IDIpIGFuZCBCb2IgaXMgdGhlIGNvYWNoIG9mIFRoZSBHbm9tZXMgKGZyb20gc2hlZXQgMSkgdGhlcmVmb3JlIEJvYiBpcyB0aGUgY29hY2ggb2YgRnJlZC7igJ0gVG8gZG8gaXQgaW4gUiAoYXMgeW91IHdvdWxkIGlmIHlvdSBuZWVkZWQgdG8gcGVyZm9ybSB0aGlzIG9wZXJhdGlvbiBmb3IgODAwIHBsYXllcnMpIHlvdSB3b3VsZCBzZWxlY3QgdGhlIFRlYW1OYW1lIHZhbHVlIGZvciBGcmVkIGluIHRoZSBQbGF5ZXJzIGZpbGUsIHRoZW4gZmlsdGVyIGZvciB0aGF0IHZhbHVlIGluIHRoZSBUZWFtcyBmaWxlIGFuZCBzZWxlY3QgdGhlIENvYWNoIGNvbHVtbi4gQWZ0ZXIgeW91IGxlYXJuIGhvdyB0byB3cml0ZSBsb29wcywgeW91IGNvdWxkIGxvb3AgdGhyb3VnaCBhbGwgdGhlIHBsYXllcnMgYW5kIGRvIHRoaXMgY29tcHV0YXRpb24sIGFjY3J1aW5nIHRoZSByZXN1bHRzIGludG8gYSB2ZWN0b3IuIFRoZW4geW91IGNvdWxkIGFkZCB0aGF0IHZlY3RvciBhcyBhIG5ldyBjb2x1bW4gc29tZXdoZXJlIHRvIG1hdGNoIHVwIHBsYXllciBhbmQgY29hY2guIEhvd2V2ZXIsIFIgcHJvdmlkZXMgbXVjaCBtb3JlIHN1Y2NpbmN0IHdheXMgdG8gcGVyZm9ybSB0aGlzIG9wZXJhdGlvbi4NCg0KVGhpcyBpcyBmb3J0dW5hdGUsIGJlY2F1c2UgcmVhbCByZXNlYXJjaCBkYXRhIHNldHMgYXJlIG9mdGVuIGRlcGxveWVkIGluIG1hbnkgbW9yZSB0aGFuIGp1c3QgdGhlIHR3byBmaWxlcyB3ZSBuZWVkZWQgaW4gb3VyIHRveSBTcG9ydHMgTGVhZ3VlIGV4YW1wbGUuIExhcmdlLCBjb21wbGV4IGRhdGEgc2V0cyBhcmUgdHlwaWNhbGx5IG5vdCBtYW5hZ2VkIHdpdGggc3ByZWFkc2hlZXRzIGF0IGFsbCwgdGhleSBhcmUgbWFuYWdlZCBhcyAqKmRhdGFiYXNlcyoqLiBXaGlsZSB0aGlzIHRlcm0gaXMgdXNlZCBxdWl0ZSBicm9hZGx5IGluIGNhc3VhbCBkaXNjdXNzaW9uLCBpdCB0ZWNobmljYWxseSByZWZlcnMgc3BlY2lmaWNhbGx5IHRvICoqUmVsYXRpb25hbCBEYXRhYmFzZSBNYW5hZ2VtZW50IFN5c3RlbXMqKiwgc3BlY2lhbCBhcHBsaWNhdGlvbnMgdGhhdCBhcmUgb3B0aW1pc2VkIGZvciBzZWFyY2hpbmcsIGRlbGV0aW5nLCBmaWx0ZXJpbmcsIGFuZCBnZW5lcmFsbHkgbWFuYWdpbmcgaHVnZSBhbW91bnRzIG9mIGRhdGEuDQoNCkluIGFuIFJEQk1TIGVhY2ggKiplbnRpdHkqKiBoYXMgaXRzIG93biAqKnRhYmxlKiogYW5kIHRoZSB0b29scyBoYXZlIEVYVFJFTUVMWSBzdHJpY3QgcnVsZXMgYWJvdXQgdGhlIGNvbnRlbnRzIGFuZCBzdHJ1Y3R1cmUgb2YgdGhlaXIgZW50aXRpZXMuIFRoZSBkYXRhIHVuaXZlcnNlIGlzIGJyb2tlbiBkb3duIGludG8gYXRvbWljIHBpZWNlcyBvZiBkYXRhIGFuZCByZWNvbWJpbmVkIHRocm91Z2ggdGhlIHJ1bGVzIG9mIGEgbWF0aGVtYXRpY2FsIGZyYW1ld29yayBjYWxsZWQgdGhlIFJlbGF0aW9uYWwgQWxnZWJyYS4gSXQgaXMgYSBiZWF1dGlmdWwgdGhpbmcsIGJ1dCB5b3UgZW5kIHVwIHdpdGggYSBsb3Qgb2YgdGFibGVzLg0KDQpUaGUgZmlndXJlIGJlbG93IGlzIGFuICoqRW50aXR5IFJlbGF0aW9uc2hpcCBEaWFncmFtKiouIEl0IHNob3dzIHRoZSBzdHJ1Y3R1cmUgb2YgdGhlIGRhdGFiYXNlIGZvciBhICpyZWxhdGl2ZWx5IHNpbXBsZSogZGF0YWJhc2Ugc3lzdGVtIHRoYXQga2VlcHMgdHJhY2sgb2YgRm9vZCBEaWFyaWVzIOKAkyB3aGVyZSBwZW9wbGUgcmVjb3JkIHdoYXQgdGhleSBlYXQgZm9yIG51dHJpdGlvbmFsIGFuYWx5c2lzLiANCg0KDQpgYGB7ciwgZmlnLmNhcCA9ICJFeGFtcGxlIEVSRCIsIGVjaG89RkFMU0UsIGZpZy5hbGlnbj0nY2VudGVyJywgb3V0LndpZHRoPSIxMDAlIn0NCmluY2x1ZGVfZ3JhcGhpY3MoImltYWdlcy8wNy1FUkQucG5nIikNCmBgYA0KDQoNCldoZW4gcmVhbCBkYXRhIGFyZSBleHBvcnRlZCB0byB5b3UgZm9yIHByb2Nlc3NpbmcsIHRoZXJlZm9yZSwgeW91IGNhbiBlbmQgdXAgd2l0aCBhIGxvdCBvZiBzZXBhcmF0ZSBmaWxlcy4gVXNpbmcgUiwgeW91IGhhdmUgdG8gYmUgYWJsZSB0byByZWNvbWJpbmUgZGF0YSBhcyBuZWVkZWQgdG8gYW5zd2VyIHlvdXIgc3BlY2lmaWMgcmVzZWFyY2ggcXVlc3Rpb25zLg0KDQoNCiMjIFNpbXBsZSBDb21iaW5pbmcgKEJpbmRzKQ0KDQpCZWZvcmUgd2UgbG9vayBhdCB0aGUgc29tZXRpbWVzIGNvbXBsZXggaXNzdWVzIGFyb3VuZCBjb21iaW5pbmcgdGFibGVzIHJlcHJlc2VudGluZyBkaWZmZXJlbnQgZW50aXRpZXMsIHdlIHdpbGwgcXVpY2tseSBjb3ZlciB0d28gc2ltcGxlciBjb21iaW5pbmcgc2l0dWF0aW9ucyB0aGF0IG9jY3VyIHdoZW4geW91IGhhdmUsIGVzc2VudGlhbGx5LCBhIHNpbmdsZSB0YWJsZSB0aGF0IGhhcyBiZWVuIGJyb2tlbiBpbnRvIG11bHRpcGxlIGlucHV0IGZpbGVzLiANCg0KT3VyIGRhdGEgZm9yIHRvZGF5IGNvbWUgZnJvbSB0aGUgKipHZWNrb3MgYW5kIEd1bWJvb3RzKiogcHJvamVjdC4gR2Vja29zIGFuZCBHdW1ib290cyBpcyBhIG11bHRpLXllYXIsIG11bHRpLWRpc2NpcGxpbmFyeSByZWNvbnN0cnVjdGlvbiBvZiB3aWxkIE5ldyBaZWFsYW5kIEdlY2tvIGhhYml0YXQgb24gdGhlIE90YWdvIFBlbmluc3VsYSAoU291dGggSXNsYW5kLCBOZXcgWmVhbGFuZCkuIEEgbGFyZ2UgYXJlYSBvZiBsYW5kIG9uIHRoZSBwZW5pbnN1bGEgaGFzIGJlZW4gcGxhbnRlZCB3aXRoIG5hdGl2ZSBnZWNrbyBoYWJpdGF0IHNwZWNpZXMsIGRpdmlkZWQgaW50byByZXBsaWNhdGUgcXVhZHJhdHMgYW5kLCBhdCBpbnRlcnZhbHMsIGRhdGEgYXJlIGNvbGxlY3RlZCBhYm91dCBwbGFudCBncm93dGgsIGFuZCBpbnZlcnRlYnJhdGUsIHByZWRhdG9yLCBhbmQgZ2Vja28gcG9wdWxhdGlvbiBhYnVuZGFuY2UuIFVuZGVyZ3JhZHVhdGUgc3R1ZGVudHMgcGFydGljaXBhdGUgaW4gZGF0YSBjb2xsZWN0aW9uIGFuZCBhbmFseXNpcyB0byBnYWluIGV4cGVyaWVuY2Ugd2l0aCBlY29sb2d5IGZpZWxkd29yay4NCg0KDQojIyMgQ29tYmluaW5nIFJvd3MNCg0KQXNzdW1lIHRoZSBmaWVsZCBlY29sb2dpc3RzIGhhdmUgc2VudCB5b3Ugc29tZSBwcmVkYXRvciBvYnNlcnZhdGlvbiBkYXRhIGZvciBhbmFseXNpcy4gVGhleSBoYXZlIHNlbnQgeW91IHRocmVlIHNlcGFyYXRlIGNzdiBmaWxlcywgb25lIGZvciBlYWNoIG9mIHRocmVlIGRhdGEgY29sbGVjdGlvbiBkYXlzLg0KDQoNCmBgYHtyLCBmaWcuY2FwID0gIkNvbWJpbmluZyBSb3dzIiwgZWNobz1GQUxTRSwgZmlnLmFsaWduPSdjZW50ZXInLCBvdXQud2lkdGg9IjEwMCUifQ0KaW5jbHVkZV9ncmFwaGljcygiaW1hZ2VzLzA3LXJiaW5kLnBuZyIpDQpgYGANCg0KQWxsIHRocmVlIGZpbGVzIGhhdmUgZXhhY3RseSB0aGUgc2FtZSBmb3JtYXQg4oCTIGZvdXIgdmFyaWFibGUgY29sdW1ucyBhbmQgb25lIHJvdyBmb3IgZWFjaCByZWNvcmRlZCBwcmVkYXRvciBvYnNlcnZhdGlvbi4gVGhpcyBpcyBhIG5pY2Ugd2F5IHRvIGdldCBkYXRhIOKAkyBldmVyeXRoaW5nIGlzIGFscmVhZHkgcmVjdGFuZ3VsYXIsIGFuZCB0aGV5IGhhdmUgYWxsIHRoZSBzYW1lIGNvbHVtbnMgaW4gdGhlIHNhbWUgb3JkZXIuIFlvdSBzaW1wbHkgbmVlZCB0byBnYXRoZXIgdGhlbSBhbGwgdXAgaW50byBhIHNpbmdsZSBkYXRhZnJhbWUg4oCTIGluIFIgdGhpcyBpcyBzdHJhaWdodGZvcndhcmQuIFVzZSBmdW5jdGlvbiBgcmJpbmRgLCBwYXNzaW5nIGluIGFsbCB0aGUgZGF0YSBmcmFtZXMgdG8gYmUgY29uY2F0ZW5hdGVkLCBzZXBhcmF0ZWQgYnkgY29tbWFzLg0KDQpgYGB7ciByYmluZH0NCnByZWRfMDFfZGYgPC0gcmVhZC5jc3YoImRhdGEvcHJlZGF0b3Jfb2JzZXJ2YXRpb25zXzIwMjJfMDRfMzAuY3N2IikNCnByZWRfMDJfZGYgPC0gcmVhZC5jc3YoImRhdGEvcHJlZGF0b3Jfb2JzZXJ2YXRpb25zXzIwMjNfMDRfMjIuY3N2IikNCnByZWRfMDNfZGYgPC0gcmVhZC5jc3YoImRhdGEvcHJlZGF0b3Jfb2JzZXJ2YXRpb25zXzIwMjNfMDRfMjMuY3N2IikNCg0KcHJlZF9hbGxfZGYgPC0gcmJpbmQocHJlZF8wMV9kZiwgcHJlZF8wMl9kZiwgcHJlZF8wM19kZikNCnByZWRfYWxsX2RmWzUwOjYwLF0NCmBgYA0KDQpOb3RlIHRoYXQgaWYgdGhlIGFyZ3VtZW50cyB0byByYmluZCBkb24ndCBhbGwgaGF2ZSBleGFjdGx5IHRoZSBzYW1lIGNvbHVtbnMsIHRoZSBmdW5jdGlvbiB3aWxsLCBxdWl0ZSBzZW5zaWJseSwgdGhyb3cgYW4gZXJyb3I6DQoNCmBgYHtyIHJiaW5kIGVycm9yLCBlcnJvcj1UUlVFfQ0KIyBGb3IgcHVycG9zZXMgb2YgaWxsdXN0cmlvbiwgd2UgZHJvcCB0aGUgNHRoIGNvbHVtbiBmcm9tIHByZWRfMDFfZGYNCnByZWRfMDFfZGYgPC0gcHJlZF8wMV9kZlsgLCAtNF0NCg0KIyBUaGUgcmJpbmQgY29tbWFuZCBub3cgZmFpbHMNCnByZWRfYWxsX2RmIDwtIHJiaW5kKHByZWRfMDFfZGYsIHByZWRfMDJfZGYsIHByZWRfMDNfZGYpDQoNCmBgYA0KDQojIyMgQ29tYmluaW5nIENvbHVtbnMNCg0KTGVzcyBjb21tb25seSwgeW91IG1pZ2h0IGhhdmUgbXVsdGlwbGUgZGF0YSBzZXRzIHdpdGggdGhlIHNhbWUgcm93cyAob2JlcnZhdGlvbnMpLCBidXQgZGlmZmVyZW50IGNvbHVtbnMgKGRlcGVuZGVudCBhbmQgaW5kZXBlbmRlbnQgdmFyaWFibGVzKS4gSW4gdGhpcyBjYXNlLCB1c2UgZnVuY3Rpb24gYGNiaW5kYCAtLSB0aGUgc3ludGF4IGlzIHRoZSBzYW1lIGFzIGZvciAgYHJiaW5kYC4gDQoNCkluIHByYWN0aWNlLCB0aGlzIHNpdHVhdGlvbiBhY3R1YWxseSBvY2N1cnMgdmVyeSByYXJlbHkuIFRoaXMgaXMgZm9ydHVuYXRlLCBiZWNhdXNlIGNvbHVtbiBiaW5kaW5nIGlzIGV4dHJlbWVseSByaXNreS4gQ29sdW1uIGJpbmRpbmcgcmVsaWVzIGVudGlyZWx5IHVwb24gdGhlIHJvd3MgaW4gdGhlIHNlcGFyYXRlIGRhdGEgZnJhbWVzIGJlaW5nIGlkZW50aWNhbCBhbmQgaW4gdGhlIHNhbWUgb3JkZXI7IHRoZSBmdW5jdGlvbiBpdHNlbGYgcGVyZm9ybXMgbm8gY2hlY2tzIG9uIHRoaXMgY29uc3RyYWludC4gDQoNCkJlY2F1c2Ugb2YgdGhlIGRhbmdlciBvZiBtaXhpbmcgdXAgZGF0YSBmcm9tIGRpZmZlcmVudCBvYnNlcnZhdGlvbnMsIEkgb25seSB1c2UgY2JpbmQgd2hlbiBJIGFtIGdlbmVyYXRpbmcgY29sdW1ucyBkeW5hbWljYWxseSAoaW4gY29kZSkgYW5kIHdpc2ggdG8gYnVpbGQgYSBkYXRhIGZyYW1lIGZyb20gdGhlbS4NCg0KICANCiMjIFJlbGF0aW9uYWwgQ29tYmluaW5nIChKb2lucykNCg0KUmVjYWxsIG91ciBTcG9ydHMgTGVhZ3VlIGRhdGE6DQoNCmBgYHtyLCBmaWcuY2FwID0gIlNwb3J0cyBMZWFndWUgZm9yIENvbXB1dGVycyIsIGVjaG89RkFMU0UsIGZpZy5hbGlnbj0nY2VudGVyJywgb3V0LndpZHRoPSIxMDAlIn0NCmluY2x1ZGVfZ3JhcGhpY3MoImltYWdlcy8wNy1zcG9ydHNfbGVhZ3VlXzAyLnBuZyIpDQpgYGANCg0KT3VyICJyZXNlYXJjaCBxdWVzdGlvbiIgd2FzIGhvdyB0byBmaW5kIHRoZSBuYW1lIG9mIEJvYidzIGNvYWNoLiBNb3JlIGdlbmVyYWxseSwgYXNzdW1lIHdlIHdhbnQgdG8ga25vdyB0aGUgY29hY2hlcyBvZiBhbGwgdGhlIHBsYXllcnMuIFdoZW4gd29ya2luZyB3aXRoIGRhdGEgZnJhbWVzLCB0aGlzIG1lYW5zIHdlIHdhbnQgdG8gYWRkIGNvbHVtbnMgdG8gdGhlIFBsYXllcidzIHRhYmxlIHRoYXQgY29udGFpbiB0aGUgYXNzb2NpYXRlZCBjb2FjaCBpbmZvcm1hdGlvbiBmb3IgZWFjaCByb3cuDQoNCldlIG5vdGVkIHRoYXQgdGhlIFRlYW0gdGFibGUgYW5kIHRoZSBQbGF5ZXIgdGFibGUgaGF2ZSBhIGNvbW1vbiBjb2x1bW4g4oCTIFRlYW1OYW1lIOKAkyBhbmQgdGhhdCB3ZSBjb3VsZCBtYXRjaCBwbGF5ZXJzIGFuZCBjb2FjaGVzIGJ5IGxvb2tpbmcgZm9yIG1hdGNoaW5nIHZhbHVlcyBvZiBUZWFtTmFtZS4gVGhpcyBpcyBhIHJlcXVpcmVtZW50IGZvciByZWxhdGlvbmFsIGNvbWJpbmluZyAtLSB0d28gdGFibGVzIG11c3Qgc2hhcmUgYSBjb21tb24gY29sdW1uIChvciBjb2x1bW5zKSB0aGF0IGNhbiBiZSB1c2VkIHRvIG1hdGNoIG9ic2VydmF0aW9ucyBiZXR3ZW4gdGhlIHRhYmxlcy4gVGhlc2UgY29tbW9uIGNvbHVtbnMgYXJlIGNhbGxlZCAqKmtleXMqKi4gDQoNCkluIGZvcm1hbCBkYXRhYmFzZXMsIHRoZXJlIGFyZSBsb3RzIG9mIHJ1bGVzIGFib3V0IGtleXMsIHBhcnRpY3VsYXJseSBhcm91bmQgKip1bmlxdWVuZXNzKiouIE5vdGUgaG93IGNvbmZ1c2luZyBpdCB3b3VsZCBiZSBpZiB0aGVyZSB3ZXJlICp0d28qIHJvd3MgaW4gdGhlIFRlYW1zIGRhdGEgZnJhbWUgd2l0aCB0ZWFtbmFtZSAqVGhlIEdub21lcyog4oCTIHdoaWNoIG9mIHRoZSB0d28gY29hY2hlcyB3b3VsZCB5b3Ugd2FudCB0byBtYXRjaCB3aXRoIEZyZWQ/IF5bTkI6IFRoZXJlIGlzIGEgbWV0aG9kIGZvciBkZWFsaW5nIHdpdGggdGhlICJtdWx0aXBsZSBjb2FjaGVzIiBwcm9ibGVtLCBidXQgaXQgaXMgb3V0IG9mIHNjb3BlIGZvciB0b2RheSdzIG1vZHVsZS4gQXNrIG1lIGZvciBtb3JlIGRldGFpbCBpZiB5b3UncmUgaW50ZXJlc3RlZC5dIEZvciB0b2RheSB3ZSB3aWxsIGFzc3VtZSB0aGF0IHRoZXNlIHJlcXVpcmVtZW50cyBhcmUgbWV0IOKAkyBmb3IgZnVydGhlciBkZXRhaWxzLCBzZWUgdGhlIFIgZm9yIERhdGEgU2NpZW5jZSBjaGFwdGVyLg0KDQojIyBKb2luDQoNCkluIGRhdGFiYXNlIHRlcm1pbm9sb2d5LCB0aGUgcHJvY2VzcyBvZiBtYXRjaGluZyB1cCByZWNvcmRzIGZyb20gbXVsdGlwbGUgdGFibGVzIGlzIGNhbGxlZCBhICoqam9pbioqLiBSIChtb3JlIHNwZWNpZmljYWxseSB0aWR5dmVyc2UpIHVzZXMgdGhpcyB0ZXJtaW5vbG9neSBhcyB3ZWxsLiAgU29sdmluZyBwcm9ibGVtcyBsaWtlIGZpbmRpbmcgdGhlIGNvYWNoIGZvciBlYWNoIHBsYXllciBpbnZvbHZlcyBqb2luaW5nIHR3byBvciBtb3JlIGRhdGEgZnJhbWVzIG9uIG9uZSBvciBtb3JlIGNvbW1vbiBjb2x1bW5zLg0KDQpUbyBzbGlnaHRseSBjb21wbGljYXRlIHRoaW5ncywgUiBkb2VzIG5vdCBwcm92aWRlIGEgZnVuY3Rpb24gY2FsbGVkIOKAnGpvaW7igJ0uICBJdCBwcm92aWRlICpzaXggZGlmZmVyZW50IGZ1bmN0aW9ucyogd2hpY2ggcGVyZm9ybSBzbGlnaHRseSBkaWZmZXJlbnQgdHlwZXMgb2Ygam9pbiBvcGVyYXRpb24uIFRoZSBmdW5jdGlvbiBuYW1lcyBhcmUgZGVyaXZlZCBmcm9tIHRoZSBmb3JtYWwgZGF0YWJhc2UgdGVybWlub2xvZ3kuIEZvcnR1bmF0ZWx5LCBpbiB0aGUgdmFzdCBtYWpvcml0eSBvZiBjYXNlcyB3ZSBlbmNvdW50ZXIsIHlvdSBvbmx5IG5lZWQgb25lIG9mIHRoZSBqb2luIGZhbWlseSAtLSBgbGVmdF9qb2luYC4gV2Ugd2lsbCBjb3ZlciBgbGVmdF9qb2luYCBoZXJlOyBzZWUgdGhlIGFkZGl0aW9uYWwgcmVhZGluZ3MgZm9yIGRpc2N1c3Npb25zIG9mIHRoZSBsZXNzIGNvbW1vbiBmb3Jtcy4NCg0KVGhlIGZ1bmN0aW9uIGBsZWZ0X2pvaW5gIHRha2VzIGFzIGFyZ3VtZW50cyB0aGUgdHdvIHRhYmxlcyAoZGF0YSBmcmFtZXMpIHlvdSB3aXNoIHRvIGpvaW4uIFRoZSBuYW1lIGBsZWZ0X2pvaW5gIGhlbHBzIHlvdSB0byByZW1lbWJlciBob3cgdG8gb3JkZXIgeW91ciBhcmd1bWVudHMg4oCTIHB1dCB0aGUgKipiYXNlIHRhYmxlKiogb24gdGhlIGxlZnQgKGkuZS4gYXMgdGhlIGZpcnN0IGFyZ3VtZW50KS4gVGhlICoqYmFzZSB0YWJsZSoqIGlzIHRoZSBvbmUgeW91IHdpc2ggdG8gYWRkIGNvbHVtbnMgdG8uDQoNClJlY2FsbCB0aGF0IHdlIHdhbnRlZCB0byBrbm93IGVhY2ggcGxheWVy4oCZcyBjb2FjaC4gV2UgdGhlcmVmb3JlIHdhbnQgdG8gYWRkIGEgQ29hY2hOYW1lIGNvbHVtbiB0byB0aGUgUGxheWVycyBkYXRhIGZyYW1lLiBUaHVzIFBsYXllcnMgaXMgdGhlICoqYmFzZSB0YWJsZSoqLiBXZSBwYXNzIGl0IGZpcnN0IGludG8gZnVuY3Rpb24gJ2xlZnRfam9pbicsIGFsb25nIHdpdGggdGhlIG5hbWUgb2YgdGhlICoqa2V5KiogY29sdW1uLg0KDQoNCmBgYHtyIG1ha2UgZGYsIGVjaG8gPSBGQUxTRX0NCnRlYW1zX21hdHJpeCA8LSBjYmluZChUZWFtTmFtZSA9IGMoIlRoZSBHbm9tZXMiLCAiVGhlIE9yY3MiLCAiVGhlIEFyYWNobmlkcyIpLA0KICAgICAgICAgICAgICAgICAgTGVhZ3VlID0gYygiT3ZlciA1MHMiLCAiV29tZW4ncyBQcmVtaWVyIiwgIlVuZGVyIDE1cyIpLA0KICAgICAgICAgICAgICAgICAgQ29hY2ggPSBjKCJCb2IiLCAiTmdhaXJlIiwgIkRvcm90aHkiKSwNCiAgICAgICAgICAgICAgICAgIENvYWNoUGhvbmUgPSBjKCI0NzQtNTU1NSIsICIwMjEgMzMzLTQ1NjciLCAiMDIyIDk4Ny02NTQzIikpDQp0ZWFtc19kZiA8LSBhcy5kYXRhLmZyYW1lKHRlYW1zX21hdHJpeCkNCg0KcGxheWVyc19tYXRyaXggPC0gY2JpbmQoUGxheWVyTmFtZSA9IGMoIkZyZWQiLCAiU2FsbHkiLCAiRXRoZWwiLCAiTHVjeSIpLA0KICAgICAgICAgICAgICAgICAgICAgICAgVGVhbU5hbWUgPSBjKCJUaGUgR25vbWVzIiwgIlRoZSBHbm9tZXMiLCAiVGhlIEdub21lcyIsICJUaGUgQXJhY2huaWRzIiksDQogICAgICAgICAgICAgICAgICAgICAgICBQbGF5ZXJQb3NpdGlvbiA9IGMoIkZpcnN0IEJhc2UiLCAiUGl0Y2hlciIsICJMZWZ0IEZpZWxkIiwgIkNhdGNoZXIiKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIFBsYXllclBob25lID0gYygiMDIxIDExMSAyMjIyIiwgIjAyMSAyMjIgMzMzMyIsICIwMjEgMTExIDQ0NDQiLCAiNDc0LTEyMzQiKSkNCnBsYXllcnNfZGYgPC0gYXMuZGF0YS5mcmFtZShwbGF5ZXJzX21hdHJpeCkNCg0KYGBgDQoNCg0KYGBge3Igam9pbl8wMX0NCiMgV2UgbmVlZCB0aGUgdGlkeXZlcnNlIHRvIGJlIGFibGUgdG8gam9pbg0KbGlicmFyeSh0aWR5dmVyc2UpDQoNCiMgQXNzdW1lIHdlIGhhdmUgaW1wb3J0ZWQgb3V0IHNwb3J0cyBsZWFndWUgZGF0YSB1c2luZyByZWFkLmNzdg0KaGVhZCh0ZWFtc19kZikNCmhlYWQocGxheWVyc19kZikNCg0KIyBQZXJmb3JtIHRoZSBqb2luDQpleHRlbmRlZF9wbGF5ZXJzX2RmIDwtIGxlZnRfam9pbihwbGF5ZXJzX2RmLCB0ZWFtc19kZiwgYnkgPSAiVGVhbU5hbWUiKQ0KDQojIFRoZSBuZXcgZGF0YSBmcmFtZQ0KZXh0ZW5kZWRfcGxheWVyc19kZg0KYGBgDQoNClRoZSBuZXcgZGF0YWZyYW1lIGhhcyBhbGwgdGhlIGNvbHVtbnMgaW4gUGxheWVycywgaW4gdGhlIG9yaWdpbmFsIG9yZGVyLiBJdCBhbHNvIGhhcyBhbGwgdGhlIGNvbHVtbnMgaW4gVGVhbXMsIGluIHRoZSBvcmlnaW5hbCBvcmRlci4gRm9yICplYWNoIHJvdyBvZiBQbGF5ZXJzKiAodGhlIGJhc2UgdGFibGU7IHRoZSBvbmUgb24gdGhlIGxlZnQpLCB0aGUgdmFsdWVzIG9mIHRoZSBUZWFtcyBjb2x1bW5zIGFyZSB0YWtlbiBmcm9tIHRoZSByb3cgaW4gVGVhbXMgdGhhdCBoYXMgdGhlIHNhbWUgdmFsdWUgaW4gY29sdW1uIFRlYW1OYW1lICh0aGUga2V5KS4NCg0KIyMjIEV4ZXJjaXNlDQoNCldoYXQgb3V0cHV0IGRvIHlvdSBleHBlY3QgaWYgeW91IHJldmVyc2UgdGhlIG9yZGVyIG9mIGBwbGF5ZXJzX2RmYCBhbmQgYHRlYW1zX2RmYCBpbiB0aGUgY2FsbCB0byBgbGVmdF9qb2luYCwgYWJvdmU/IFRyeSB0byB0aGluayB0aHJvdWdoIHRoaXMgZXhlcmNpc2UgYmVmb3JlIHRlc3RpbmcgdGhlIGNvZGUuIEhpbnQ6IFdoZW4geW91IHJlYWNoIHRoZSBwb2ludCB3aGVyZSB5b3Ugc2F5ICJidXQgdGhhdCBkb2Vzbid0IG1ha2Ugc2Vuc2UhIiwgcmVjb2duaXNlIHRoYXQgdGhlIGNvbXB1dGVyIHdpbGwgYmUgaW4gdGhlIHNhbWUgc2l0dWF0aW9uLg0KDQojIyBQcmFjdGljZSBKb2luaW5nDQoNClRoZSBHZWNrb3MgYW5kIEd1bWJvb3RzIHByb2plY3QgcHJvdmlkZXMgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHBsYW50cyBvYnNlcnZlZCBncm93aW5nIGluIGVhY2ggcXVhZHJhdCAocmVzb3VyY2UgZmlsZSAqcGxhbnRfb2JzZXJ2YXRpb25zLmNzdiopLiBJbiBhIHNlcGFyYXRlIGZpbGUsIHRoZXkgcHJvdmlkZSBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGFib3V0IHBsYW50IHNwZWNpZXMgKHJlc291cmNlIGZpbGUgKnBsYW50X3NwZWNpZXMuY3N2KikuIFRoaXMgbWlycm9ycyB0aGUgc3RydWN0dXJlIG9mIHRoZSBkYXRhYmFzZSwgd2hlcmUgdGhlc2UgZW50aXRpZXMgYXJlIHN0b3JlZCBzZXBhcmF0ZWx5IHRvIGFsbG93IGVmZmljaWVudCBkYXRhIG9wZXJhdGlvbnMgYW5kIGNvbXBsZXRlIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBkYXRhIHVuaXZlcnNlIChlLmcuIHRvIGFsbG93IGluZm9ybWF0aW9uIHRvIGJlIHN0b3JlZCBmb3IgcGxhbnQgc3BlY2llcyB0aGF0IGhhdmUgbm90IHlldCBiZWVuIG9ic2VydmVkLCBidXQgd2hpY2ggYXJlIGV4cGVjdGVkIHRvIGJlIGluIHRoZSBmdXR1cmUpLg0KDQpgYGB7ciwgZmlnLmNhcCA9ICJQbGFudCBPYnNlcnZhdGlvbiBhbmQgU3BlY2llcyBEYXRhIElucHV0IEZpbGVzIiwgZWNobz1GQUxTRSwgZmlnLmFsaWduPSdjZW50ZXInLCBvdXQud2lkdGg9IjEwMCUifQ0KaW5jbHVkZV9ncmFwaGljcygiaW1hZ2VzLzA3LXBsYW50X2RhdGFfaW5wdXRfZmlsZXMucG5nIikNCmBgYA0KDQoqKllvdXIgam9iKio6IFByb2R1Y2UgYSBuZXcgZGF0YSBmcmFtZSB0aGF0IGFkZHMgZmFtaWx5IGFuZCBjb21tb24gbmFtZXMgZm9yIGVhY2ggcGxhbnQgb2JzZXJ2YXRpb24uDQoNCmBgYHtyIHBsYW50IGpvaW4gc29sdXRpb259DQojIExvYWQgdGhlIGlucHV0IGRhdGEgZnJhbWVzDQpwbGFudF9vYnNfZGYgPC0gcmVhZC5jc3YoImRhdGEvcGxhbnRfb2JzZXJ2YXRpb25zLmNzdiIpDQpwbGFudF9zcGVjaWVzX2RmIDwtIHJlYWQuY3N2KCJkYXRhL3BsYW50X3NwZWNpZXMuY3N2IikNCg0KIyBQZXJmb3JtIHRoZSBqb2luDQpleHRlbmRlZF9wbGFudF9vYnNfZGYgPC0gbGVmdF9qb2luKHBsYW50X29ic19kZiwgcGxhbnRfc3BlY2llc19kZiwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5fYnkoUGxhbnRTcGVjaWVzKSkNCg0KIyBEaXNwbGF5IGEgc2VjdGlvbiBvZiB0aGUgcmVzdWx0DQpleHRlbmRlZF9wbGFudF9vYnNfZGZbNTU6NjUsXQ0KYGBgDQoNCiMjIEEgQ29tcGxldGUgUmVzZWFyY2ggUXVlc3Rpb24NCg0KUGFja2FnZSBgbnljZmxpZ2h0czEzYCBjb250YWlucyBzZXZlcmFsIGRhdGEgZnJhbWVzIHdoaWNoIGhvbGQgaGlzdG9yaWNhbCBkYXRhIGFib3V0IGFpcnBsYW5lIGZsaWdodHMgaW4gYW5kIG91dCBvZiB0aGUgc2V2ZXJhbCBhaXJwb3J0cyBpbiBOZXcgWW9yayBjaXR5LiBUaGVyZSBpcyBvbmUgdGFibGUgZm9yIGVhY2ggaW1wb3J0YW50IGVudGl0eS4gRWFjaCB0YWJsZSBjb250YWlucyBlbnRpdHkgcHJvcGVydGllcywgYW5kIHJlbGF0aW9uIGluZm9ybWF0aW9uLg0KDQotIGFpcnBvcnRzOiBBaXJwb3J0IEZBQSBjb2RlLCBuYW1lLCBsYXRpdHVkZSwgbG9uZ2l0dWRlLCB0aW1lIHpvbmUsIGV0Yy4gZm9yIGVhY2ggYWlycG9ydA0KLSBwbGFuZXM6IFRhaWwgbnVtYmVyLCB5ZWFyIG9mIG1hbnVmYWN0dXJlLCBhbmQgdGVjaG5pY2FsIHNwZWNpZmljYXRpb24gZm9yIGVhY2ggcGxhbmUNCi0gYWlybGluZXM6IEZBQSBjb2RlIGFuZCBjb21wYW55IG5hbWUgZm9yIGVhY2ggYWlybGluZQ0KLSBmbGlnaHRzOiBEYXRlLCBkZXBhcnR1cmUgYW5kIGFycml2YWwgdGltZXMsIHBsYW5lIGluZm9ybWF0aW9uLCBkaXN0YW5jZSwgYWlybGluZSBjb2RlLCBldGMuIGZvciBlYWNoIGZsaWdodA0KDQoNCioqWW91ciBqb2IqKjogRGV0ZXJtaW5lIHdoaWNoIGFpcmxpbmUgZmxldyB0aGUgdG90YWwgZ3JlYXRlc3QgZGlzdGFuY2UgdXNpbmcgc2luZ2xlIGVuZ2luZSBwbGFuZXMuDQoNCioqSGludCoqOiBEbyBub3Qgc3RhcnQgdHlwaW5nIGNvZGUgeWV0Lg0KDQpXaXRoIGFueSBidXQgdGhlIHNpbXBsZXN0IHByb2JsZW1zLCB5b3Ugc2hvdWxkIGFsd2F5cyBtYWtlIGEgcGxhbiAqYmVmb3JlKiB5b3Ugc3RhcnQgY29kaW5nLiBSZW1lbWJlciB0aGF0IGNvbXB1dGVycyBuZWVkIHRvIGhhdmUgKipldmVyeSBzaW5nbGUgc3RlcCoqIGxhaWQgb3V0IGZvciB0aGVtLCBhbmQgaW4gd2F5cyB0aGV5IHVuZGVyc3RhbmQuIEl0IGlzIG9mdGVuIGRpZmZpY3VsdCB0byB3b3JrIG91dCBleGFjdGx5IHdoYXQgdGhvc2Ugc3RlcHMgc2hvdWxkIGJlLg0KDQpPdXIgaW50aWFsIHBsYW4gbWlnaHQgYmU6DQoNCjEuIEZpbmQgYWxsIHRoZSBmbGlnaHRzIG1hZGUgYnkgc2luZ2xlIGVuZ2luZSBwbGFuZXMNCjIuIEFkZCB0aGUgZGlzdGFuY2VzIHVwIGZvciBlYWNoIGFpcmxpbmUNCjMuIFNlZSB3aGljaCBpcyB0aGUgbGFyZ2VzdC4NCg0KQnV0IHRoaXMgcGxhbiBpcyBub3Qgc3VmZmljaWVudGx5IGRldGFpbGVkIGZvciB0aGUgY29tcHV0ZXIuIEhvdywgZm9yIGV4YW1wbGUsIHdpbGwgeW91IHRlbGwgdGhlIGNvbXB1dGVyIHRvIGRldGVybWluZSB3aGljaCBmbGlnaHRzIHdlcmUgbWFkZSBieSBzaW5nbGUgZW5naW5lIHBsYW5lcz8gVGhlIGBwbGFuZXNgIGRhdGEgZnJhbWUgY29udGFpbnMgdGhlIG51bWJlciBvZiBlbmdpbmVzIGZvciBlYWNoIHBsYW5lLCBidXQgdGhlIGBmbGlnaHRzYCBkYXRhIGZyYW1lIGRvZXMgbm90IC0tIGl0IGNvbnRhaW5zIG9ubHkgdGhlIGZsaWdodCBudW1iZXIgKGNvbHVtbiBgZmxpZ2h0bnVtYCkuIEZvcnR1bmF0ZWx5LCBgcGxhbmVzYCBhbHNvIGNvbnRhaW5zIGBmbGlnaHRudW1gIHNvIHdlIGNhbiB1c2UgdGhhdCBjb2x1bW4gYXMgYSBrZXkgdG8gam9pbiB0aGUgdHdvIHRhYmxlcy4NCg0KT3VyIGNvbXB1dGVyLWZyaWVuZGx5IHBsYW46DQoNCjEuIEpvaW4gYGZsaWdodHNgIGFuZCBgcGxhbmVzYCB3aXRoIGZsaWdodHMgYXMgdGhlIGJhc2UgYW5kIGB0YWlsbnVtYCBhcyB0aGUga2V5IHRvIGFkZCB0aGUgcGxhbmUgaW5mb3JtYXRpb24gZm9yIGVhY2ggZmxpZ2h0Lg0KMi4gRnJvbSB0aGUgcmVzdWx0aW5nIGV4dGVuZGVkIGZsaWdodHMgZGF0YSwgc2VsZWN0IHRob3NlIHdpdGggb25seSBvbmUgZW5naW5lIChpLmUuIGZpZWxkIGVuZ2luZXMgPT0gMSkNCjMuIFRoZSBmbGlnaHRzIHRhYmxlIGNvbnRhaW5zIGNvbHVtbiBgY2FycmllcmAgdG8gaWRlbnRpZnkgdGhlIGFpcmxpbmUuIFVzZSBncm91cF9ieSBhbmQgc3VtbWFyaXNlIHRvIGNvbXB1dGUgdGhlIHRvdGFsIGBkaXN0YW5jZWAgZ3JvdXBlZCBieSBgY2FycmllcmAuDQo0LiBQaWNrIHRoZSBsYXJnZXN0DQoNCg0KTm93IHlvdSBhcmUgcmVhZHkgdG8gd3JpdGUgeW91ciBjb2RlOg0KDQpgYGB7ciBmbGlnaHQgZGlzdGFuY2V9DQoNCmxpYnJhcnkobnljZmxpZ2h0czEzKQ0KDQojIDEuIEpvaW4gYGZsaWdodHNgIGFuZCBgcGxhbmVzYCB3aXRoIGZsaWdodHMgYXMgdGhlIGJhc2UgYW5kIGB0YWlsbnVtYCBhcyB0aGUga2V5IHRvIGFkZCB0aGUgcGxhbmUgaW5mb3JtYXRpb24gZm9yIGVhY2ggZmxpZ2h0Lg0KDQpmbGlnaHRzX3BsYW5lcyA8LSBsZWZ0X2pvaW4oZmxpZ2h0cywgcGxhbmVzLCBieSA9ICJ0YWlsbnVtIikNCg0KIyAyLiBGcm9tIHRoZSByZXN1bHRpbmcgZXh0ZW5kZWQgZmxpZ2h0cyBkYXRhLCBzZWxlY3QgdGhvc2Ugd2l0aCBvbmx5IG9uZSBlbmdpbmUgKGkuZS4gZmllbGQgZW5naW5lcyA9PSAxKQ0KDQpzaW5nbGVfZW5naW5lX2ZsaWdodHMgPC0gZmxpZ2h0c19wbGFuZXMgJT4lIGZpbHRlcihlbmdpbmVzID09IDEpDQoNCiMgMy4gVGhlIGZsaWdodHMgdGFibGUgY29udGFpbnMgY29sdW1uIGBjYXJyaWVyYCB0byBpZGVudGlmeSB0aGUgYWlyZWxpbmUuIFVzaW5nIGdyb3VwX2J5IGFuZCBzdW1tYXJpc2UgY29tcHV0ZSB0aGUgdG90YWwgYGRpc3RhbmNlYCBncm91cGVkIGJ5IGBjYXJyaWVyYC4NCg0KY2Fycmllcl9kaXN0YW5jZSA8LSBzaW5nbGVfZW5naW5lX2ZsaWdodHMgJT4lIGdyb3VwX2J5KGNhcnJpZXIpICU+JSBzdW1tYXJpc2UoVG90YWxEaXN0YW5jZSA9IHN1bShkaXN0YW5jZSkpDQoNCiMgNC4gUGljayB0aGUgbGFyZ2VzdA0KDQojIFNvcnQgZGVzY2VuZGluZw0KY2Fycmllcl9kaXN0YW5jZSA8LSBjYXJyaWVyX2Rpc3RhbmNlICU+JSBhcnJhbmdlKGRlc2MoVG90YWxEaXN0YW5jZSkpDQoNCiMgRGlzcGxheQ0KY2Fycmllcl9kaXN0YW5jZQ0KDQoNCmBgYA0KDQpUaGlzIGlzIGNsb3NlLCBidXQgd2hhdCBpZiB5b3UgZG9uJ3Qga25vdyB3aGF0IEI2IHN0YW5kcyBmb3I/LiBSZWNhbGwgdGhhdCBkYXRhIGZyYW1lIGBhaXJsaW5lc2AgY29udGFpbnMgY2FycmllciBjb2RlIGFuZCBmdWxsIG5hbWUuIFRvIGltcHJvdmUgeW91ciBhbmFseXNpcyBjbGFyaXR5LCBleHRlbmQgeW91ciBgY2Fycmllcl9kaXN0YW5jZWAgdGFibGUgdG8gaW5jbHVkZSB0aGUgZnVsbCBhaXJsaW5lIG5hbWUuIFdoYXQgb3BlcmF0aW9uIHdpbGwgeW91IHBlcmZvcm0/IFdoYXQgYXJndW1lbnRzIHdpbGwgeW91IHByb3ZpZGU/DQoNCmBgYHtyIGFpcmxpbmUgbmFtZX0NCmxlZnRfam9pbihjYXJyaWVyX2Rpc3RhbmNlLCBhaXJsaW5lcywgYnkgPSAiY2FycmllciIpDQpgYGANCg0KWW91IGhhdmUgbm93IGVzdGFibGlzaGVkIHRoYXQgSmV0Qmx1ZSBBaXJ3YXlzIGZsZXcgdGhlIGdyZWF0ZXN0IHRvdGFsIGRpc3RhbmNlIHVzaW5nIHNpbmdsZSBlbmdpbmUgcGxhbmVzLg0K</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("07-combine.Rmd");
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
